<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwiftTrack Express | Package Tracking</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --accent: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            animation: fadeInDown 0.8s;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo img {
            height: 40px;
        }
        
        .logo h1 {
            font-weight: 700;
            font-size: 1.75rem;
            background: linear-gradient(to right, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .logo span {
            color: var(--accent);
        }
        
        nav ul {
            display: flex;
            gap: 1.5rem;
            list-style: none;
        }
        
        nav a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }
        
        nav a:hover {
            color: var(--primary);
        }
        
        nav a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 0;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }
        
        nav a:hover::after {
            width: 100%;
        }
        
        .hero {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeIn 1s;
        }
        
        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(to right, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .hero p {
            font-size: 1.1rem;
            color: #7f8c8d;
            max-width: 700px;
            margin: 0 auto 2rem;
        }
        
        .section {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: fadeInUp 0.8s;
        }
        
        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .section-header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .section-header h2 {
            font-weight: 600;
            font-size: 1.25rem;
        }
        
        .section-header i {
            font-size: 1.25rem;
        }
        
        .section-body {
            padding: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }
        
        input, select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .dimensions-input {
            display: flex;
            gap: 0.75rem;
        }
        
        .dimensions-input input {
            flex: 1;
        }
        
        .carrier-selector {
            margin: 1.25rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .carrier-option {
            margin: 0.75rem 0;
            display: flex;
            align-items: center;
        }
        
        .carrier-option input {
            width: auto;
            margin-right: 0.75rem;
        }
        
        button {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        .package-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            animation: fadeIn 0.8s;
        }
        
        .status-item {
            margin: 1rem 0;
            padding: 1rem;
            border-left: 3px solid #ddd;
            transition: all 0.3s ease;
            animation: fadeInRight 0.5s;
        }
        
        .status-item:hover {
            background: #f8f9fa;
            transform: translateX(5px);
        }
        
        .status-item.current {
            border-left-color: var(--secondary);
            background: #f8f9fa;
            font-weight: 500;
        }
        
        .share-options {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px dashed #ddd;
        }
        
        .share-btn {
            margin-right: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .share-btn.whatsapp {
            background: linear-gradient(to right, #25D366, #128C7E);
        }
        
        .share-btn.email {
            background: linear-gradient(to right, #3498db, #2980b9);
        }
        
        .share-btn.link {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
        }
        
        .copy-btn {
            background: linear-gradient(to right, #f39c12, #e67e22);
        }
        
        #qrcode {
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            display: inline-block;
            box-shadow: var(--shadow);
        }
        
        .weight-category {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .category-small {
            background: #a8e6cf;
            color: #1a5276;
        }
        
        .category-medium {
            background: #fdffb6;
            color: #7d6608;
        }
        
        .category-large {
            background: #ffaaa5;
            color: #78281f;
        }
        
        .shipping-cost {
            font-weight: 600;
            color: var(--dark);
        }
        
        .volumetric-weight {
            color: #e67e22;
            font-weight: 600;
        }
        
        .rate-chart {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            animation: fadeIn 0.8s;
        }
        
        .rate-chart th, .rate-chart td {
            border: 1px solid #ddd;
            padding: 0.75rem;
            text-align: left;
        }
        
        .rate-chart th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .rate-chart tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .tooltip {
            position: fixed;
            background: var(--dark);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: fadeInOut 2s forwards;
            box-shadow: var(--shadow);
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-10px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }
        
        .tracking-animation {
            position: relative;
            height: 4px;
            background: #eee;
            border-radius: 2px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .tracking-progress {
            position: absolute;
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 2px;
            animation: progressAnimation 2s infinite linear;
        }
        
        @keyframes progressAnimation {
            0% { width: 0%; left: 0; }
            50% { width: 100%; left: 0; }
            100% { width: 0%; left: 100%; }
        }
        
        footer {
            text-align: center;
            margin-top: 3rem;
            padding: 1.5rem;
            color: #7f8c8d;
            font-size: 0.9rem;
            animation: fadeIn 1s;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 1rem;
            }
            
            nav ul {
                gap: 1rem;
            }
            
            .dimensions-input {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .section-body {
                padding: 1rem;
            }
        }
        
        /* Status color coding */
        .status-created { color: #3498db; }
        .status-processing { color: #f39c12; }
        .status-in_transit { color: #9b59b6; }
        .status-out_for_delivery { color: #e74c3c; }
        .status-delivered { color: #2ecc71; }
        .status-exception { color: #e74c3c; font-weight: 600; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <img src="https://cdn-icons-png.flaticon.com/512/3079/3079165.png" alt="SwiftTrack Logo">
                <h1>LK<span>Track</span></h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="#"><i class="fas fa-truck"></i> Services</a></li>
                    <li><a href="#"><i class="fas fa-phone-alt"></i> Contact</a></li>
                </ul>
            </nav>
        </header>

        <div class="hero">
            <h2 class="animate__animated animate__fadeIn">Track Your Packages Instantly</h2>
            <p class="animate__animated animate__fadeIn animate__delay-1s">Real-time tracking for all your shipments with SwiftTrack Express Delivery Service</p>
            <div class="tracking-animation animate__animated animate__fadeIn animate__delay-2s">
                <div class="tracking-progress"></div>
            </div>
        </div>

        <div class="section animate__animated animate__fadeInUp">
            <div class="section-header">
                <i class="fas fa-box-open"></i>
                <h2>Create New Package</h2>
            </div>
            <div class="section-body">
                <div class="form-group">
                    <label for="sender"><i class="fas fa-user"></i> Sender:</label>
                    <input type="text" id="sender" placeholder="Sender name" required>
                </div>
                
                <div class="form-group">
                    <label for="recipient"><i class="fas fa-user-tag"></i> Recipient:</label>
                    <input type="text" id="recipient" placeholder="Recipient name" required>
                </div>
                
                <div class="form-group">
                    <label for="origin"><i class="fas fa-map-marker-alt"></i> Origin:</label>
                    <input type="text" id="origin" placeholder="Origin city" required>
                </div>
                
                <div class="form-group">
                    <label for="destination"><i class="fas fa-map-marker-alt"></i> Destination:</label>
                    <input type="text" id="destination" placeholder="Destination city" required>
                </div>
                
                <div class="form-group">
                    <label for="service"><i class="fas fa-shipping-fast"></i> Service Type:</label>
                    <select id="service" required>
                        <option value="">-- Select Service --</option>
                        <option value="standard">Standard (3-5 days)</option>
                        <option value="express">Express (1-2 days)</option>
                        <option value="priority">Priority (Next day)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-ruler-combined"></i> Dimensions (cm):</label>
                    <div class="dimensions-input">
                        <input type="number" id="length" placeholder="Length" min="1">
                        <input type="number" id="width" placeholder="Width" min="1">
                        <input type="number" id="height" placeholder="Height" min="1">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="weight"><i class="fas fa-weight-hanging"></i> Weight (kg):</label>
                    <input type="number" id="weight" placeholder="Package weight" min="0.1" step="0.1" required>
                </div>
                
                <div class="carrier-selector">
                    <label><i class="fas fa-truck-loading"></i> Shipping Carrier:</label>
                    <div class="carrier-option">
                        <input type="radio" id="carrier-standard" name="carrier" value="standard" checked>
                        <label for="carrier-standard">Standard (≤25kg)</label>
                    </div>
                    <div class="carrier-option">
                        <input type="radio" id="carrier-premium" name="carrier" value="premium">
                        <label for="carrier-premium">Premium (≤50kg)</label>
                    </div>
                    <div class="carrier-option">
                        <input type="radio" id="carrier-freight" name="carrier" value="freight">
                        <label for="carrier-freight">Freight (>50kg)</label>
                    </div>
                </div>
                
                <div id="weightPreview">
                    <div id="volumetricDisplay"></div>
                    <div id="finalWeightDisplay"></div>
                    <div id="shippingRateChart"></div>
                </div>
                
                <button onclick="createPackage()" class="animate__animated animate__pulse animate__infinite">
                    <i class="fas fa-plus-circle"></i> Create Package
                </button>
            </div>
            <div id="newPackageInfo" class="package-info hidden"></div>
        </div>
        
        <div class="section animate__animated animate__fadeInUp animate__delay-1s">
            <div class="section-header">
                <i class="fas fa-tasks"></i>
                <h2>Update Package Status (Admin)</h2>
            </div>
            <div class="section-body">
                <div class="form-group">
                    <label for="adminTrackingNumber"><i class="fas fa-barcode"></i> Tracking Number:</label>
                    <input type="text" id="adminTrackingNumber" placeholder="Enter tracking number" required>
                </div>
                
                <div class="form-group">
                    <label for="statusUpdate"><i class="fas fa-exchange-alt"></i> New Status:</label>
                    <select id="statusUpdate" required>
                        <option value="">-- Select Status --</option>
                        <option value="created">Created</option>
                        <option value="processing">Processing</option>
                        <option value="in_transit">In Transit</option>
                        <option value="out_for_delivery">Out for Delivery</option>
                        <option value="delivered">Delivered</option>
                        <option value="exception">Exception</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="updateLocation"><i class="fas fa-map-pin"></i> Location:</label>
                    <input type="text" id="updateLocation" placeholder="Current location" required>
                </div>
                
                <button onclick="updatePackageStatus()">
                    <i class="fas fa-sync-alt"></i> Update Status
                </button>
            </div>
            <div id="updateResult" class="package-info hidden"></div>
        </div>
        
        <div class="section animate__animated animate__fadeInUp animate__delay-2s">
            <div class="section-header">
                <i class="fas fa-search-location"></i>
                <h2>Track Package</h2>
            </div>
            <div class="section-body">
                <div class="form-group">
                    <label for="trackingNumber"><i class="fas fa-barcode"></i> Tracking Number:</label>
                    <input type="text" id="trackingNumber" placeholder="Enter tracking number" required>
                </div>
                
                <button onclick="trackPackage()">
                    <i class="fas fa-search"></i> Track
                </button>
            </div>
            <div id="trackingResults" class="hidden">
                <div class="package-info" id="packageDetails"></div>
                
                <h3 style="margin-top: 1.5rem;"><i class="fas fa-history"></i> Tracking History</h3>
                <div id="trackingHistory"></div>
                
                <!-- <div class="share-options">
                    <h4><i class="fas fa-share-alt"></i> Share Tracking Details:</h4>
                    <button id="whatsappShareBtn" class="share-btn whatsapp">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </button>
                    <button id="emailShareBtn" class="share-btn email">
                        <i class="fas fa-envelope"></i> Email
                    </button>
                    <button id="copyLinkBtn" class="share-btn link">
                        <i class="fas fa-link"></i> Copy Link
                    </button>
                    <button id="copyNumberBtn" class="share-btn copy-btn">
                        <i class="fas fa-copy"></i> Copy Number
                    </button>
                    <div id="qrcode"></div>
                </div> -->
            </div>
        </div>
        
        <footer class="animate__animated animate__fadeIn animate__delay-3s">
            <p>© 2025 SwiftTrack Express Delivery. All rights reserved.</p>
            <div style="margin-top: 0.5rem;">
                <a href="#" style="color: #7f8c8d; margin: 0 0.5rem;"><i class="fab fa-facebook-f"></i></a>
                <a href="#" style="color: #7f8c8d; margin: 0 0.5rem;"><i class="fab fa-twitter"></i></a>
                <a href="#" style="color: #7f8c8d; margin: 0 0.5rem;"><i class="fab fa-instagram"></i></a>
            </div>
        </footer>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    
    <script>
        // ======================
        // CORE SYSTEM
        // ======================
        let packageDatabase = JSON.parse(localStorage.getItem('packageDatabase')) || {};
        let currentTrackingNumber = '';
        
        // Generate tracking number
        function generateTrackingNumber(prefix = 'TRK') {
            const timestamp = Date.now().toString().slice(-6);
            const randomStr = Math.random().toString(36).substring(2, 8).toUpperCase();
            return `${prefix}-${timestamp}-${randomStr}`;
        }

        // Format status display
        function formatStatus(status) {
            const statusMap = {
                'created': {text: 'Created', class: 'status-created', icon: 'fa-box-open'},
                'processing': {text: 'Processing', class: 'status-processing', icon: 'fa-cog'},
                'in_transit': {text: 'In Transit', class: 'status-in_transit', icon: 'fa-truck'},
                'out_for_delivery': {text: 'Out for Delivery', class: 'status-out_for_delivery', icon: 'fa-motorcycle'},
                'delivered': {text: 'Delivered', class: 'status-delivered', icon: 'fa-check-circle'},
                'exception': {text: 'Exception', class: 'status-exception', icon: 'fa-exclamation-triangle'}
            };
            const statusInfo = statusMap[status] || {text: status, class: '', icon: 'fa-question-circle'};
            return `<span class="${statusInfo.class}"><i class="fas ${statusInfo.icon}"></i> ${statusInfo.text}</span>`;
        }

        // Save to localStorage
        function saveDatabase() {
            localStorage.setItem('packageDatabase', JSON.stringify(packageDatabase));
        }

        // Generate shareable link
        function generateShareableLink(trackingNumber) {
            if (window.location.href.startsWith('file://')) {
                return `Tracking Number: ${trackingNumber}\n\nOpen the tracking system and enter this number.`;
            }
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.set('tracking', trackingNumber);
            return currentUrl.toString();
        }

        // Show tooltip
        function showTooltip(message) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            document.body.appendChild(tooltip);
            setTimeout(() => document.body.removeChild(tooltip), 2000);
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showTooltip('Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showTooltip('Failed to copy. Please try again.');
            });
        }

        // ======================
        // WEIGHT & SHIPPING FEATURES
        // ======================
        const WEIGHT_CATEGORIES = {
            SMALL: { max: 1, name: "Small", class: "category-small", icon: "fa-box" },
            MEDIUM: { max: 5, name: "Medium", class: "category-medium", icon: "fa-box-open" },
            LARGE: { max: Infinity, name: "Large", class: "category-large", icon: "fa-pallet" }
        };

        const SHIPPING_RATES = {
            standard: {
                base: 8,
                rates: [
                    { max: 1, price: 5 },
                    { max: 5, price: 10 },
                    { max: 25, price: 15 }
                ],
                limit: 25,
                icon: "fa-truck"
            },
            premium: {
                base: 12,
                rates: [
                    { max: 5, price: 15 },
                    { max: 25, price: 25 },
                    { max: 50, price: 40 }
                ],
                limit: 50,
                icon: "fa-shipping-fast"
            },
            freight: {
                base: 50,
                rates: [
                    { max: 100, price: 80 },
                    { max: 500, price: 150 }
                ],
                limit: Infinity,
                icon: "fa-truck-moving"
            }
        };

        // Calculate volumetric weight
        function calculateVolumetricWeight(length, width, height) {
            return (length * width * height) / 5000; // Standard volumetric divisor
        }

        // Get weight category
        function getWeightCategory(weight) {
            if (weight < 1) return WEIGHT_CATEGORIES.SMALL;
            if (weight < 5) return WEIGHT_CATEGORIES.MEDIUM;
            return WEIGHT_CATEGORIES.LARGE;
        }

        // Check carrier limits
        function checkCarrierLimits(weight, carrier) {
            const limit = SHIPPING_RATES[carrier].limit;
            if (weight > limit) {
                return {
                    valid: false,
                    message: `⚠️ Warning: ${weight}kg exceeds ${carrier} carrier limit (${limit}kg)`
                };
            }
            return { valid: true };
        }

        // Calculate shipping cost
        function calculateShippingCost(weight, carrier) {
            const carrierRates = SHIPPING_RATES[carrier];
            let rate = carrierRates.base;
            
            for (const tier of carrierRates.rates) {
                if (weight <= tier.max) {
                    rate += tier.price;
                    break;
                }
            }
            
            // Add distance-based pricing (example: $0.10 per kg per 100km)
            const distanceCost = weight * 0.10 * (Math.random() * 5 + 1); // Random distance for demo
            rate += distanceCost;
            
            return Math.round(rate * 100) / 100; // Round to 2 decimal places
        }

        // Update weight calculations in real-time
        function updateWeightCalculations() {
            const length = parseFloat(document.getElementById('length').value) || 0;
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            const physicalWeight = parseFloat(document.getElementById('weight').value) || 0;
            const carrier = document.querySelector('input[name="carrier"]:checked').value;
            
            const volumetricWeight = calculateVolumetricWeight(length, width, height);
            const finalWeight = Math.max(physicalWeight, volumetricWeight);
            const limitCheck = checkCarrierLimits(finalWeight, carrier);
            const cost = calculateShippingCost(finalWeight, carrier);
            const category = getWeightCategory(finalWeight);
            const carrierIcon = SHIPPING_RATES[carrier].icon;
            
            document.getElementById('volumetricDisplay').innerHTML = `
                <p><i class="fas fa-cube"></i> Volumetric Weight: <span class="volumetric-weight">${volumetricWeight.toFixed(2)}kg</span>
                <small>(${length}×${width}×${height}cm / 5000)</small></p>
            `;
            
            document.getElementById('finalWeightDisplay').innerHTML = `
                <p><i class="fas fa-weight-hanging"></i> Chargeable Weight: <strong>${finalWeight.toFixed(2)}kg</strong>
                <span class="weight-category ${category.class}"><i class="fas ${category.icon}"></i> ${category.name}</span>
                ${limitCheck.valid ? '' : `<span style="color:red">${limitCheck.message}</span>`}</p>
                <p><i class="fas fa-dollar-sign"></i> Estimated Cost: <span class="shipping-cost">$${cost}</span></p>
            `;
            
            document.getElementById('shippingRateChart').innerHTML = `
                <table class="rate-chart">
                    <tr>
                        <th><i class="fas fa-truck"></i> Carrier</th>
                        <th><i class="fas fa-weight-hanging"></i> Max Weight</th>
                        <th><i class="fas fa-dollar-sign"></i> Base Rate</th>
                        <th><i class="fas fa-layer-group"></i> Tiered Rates</th>
                    </tr>
                    ${Object.entries(SHIPPING_RATES).map(([name, data]) => `
                        <tr ${name === carrier ? 'style="background:#e3f2fd"' : ''}>
                            <td><i class="fas ${data.icon}"></i> ${name.charAt(0).toUpperCase() + name.slice(1)}</td>
                            <td>${data.limit}kg</td>
                            <td>$${data.base}</td>
                            <td>${data.rates.map(r => `≤${r.max}kg: +$${r.price}`).join(', ')}</td>
                        </tr>
                    `).join('')}
                </table>
            `;
        }

        // ======================
        // MAIN FUNCTIONS
        // ======================
        function createPackage() {
            const requiredFields = ['sender', 'recipient', 'origin', 'destination', 'service', 'weight'];
            const missingFields = requiredFields.filter(field => !document.getElementById(field).value);
            
            if (missingFields.length > 0) {
                document.getElementById('newPackageInfo').innerHTML = `
                    <div class="error"><i class="fas fa-exclamation-circle"></i> Please fill in all required fields: ${missingFields.join(', ')}</div>
                `;
                document.getElementById('newPackageInfo').classList.remove('hidden');
                document.getElementById('newPackageInfo').classList.add('animate__animated', 'animate__headShake');
                setTimeout(() => {
                    document.getElementById('newPackageInfo').classList.remove('animate__headShake');
                }, 1000);
                return;
            }

            const trackingNumber = generateTrackingNumber();
            const length = parseFloat(document.getElementById('length').value) || 0;
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            const physicalWeight = parseFloat(document.getElementById('weight').value);
            const carrier = document.querySelector('input[name="carrier"]:checked').value;
            
            const volumetricWeight = calculateVolumetricWeight(length, width, height);
            const finalWeight = Math.max(physicalWeight, volumetricWeight);
            const limitCheck = checkCarrierLimits(finalWeight, carrier);
            
            if (!limitCheck.valid) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error animate__animated animate__headShake';
                errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${limitCheck.message}`;
                document.getElementById('weightPreview').prepend(errorDiv);
                setTimeout(() => {
                    errorDiv.classList.remove('animate__headShake');
                }, 1000);
                return;
            }
            
            const shippingCost = calculateShippingCost(finalWeight, carrier);
            const category = getWeightCategory(finalWeight);
            
            const packageData = {
                sender: document.getElementById('sender').value,
                recipient: document.getElementById('recipient').value,
                origin: document.getElementById('origin').value,
                destination: document.getElementById('destination').value,
                service: document.getElementById('service').value,
                trackingNumber: trackingNumber,
                status: 'created',
                currentLocation: document.getElementById('origin').value,
                dimensions: { length, width, height },
                physicalWeight,
                volumetricWeight,
                finalWeight,
                weightCategory: category.name,
                carrier,
                shippingCost,
                history: [{
                    status: 'created',
                    timestamp: new Date(),
                    location: document.getElementById('origin').value,
                    notes: `Package created (${category.name}, ${finalWeight.toFixed(2)}kg)`
                }]
            };
            
            packageDatabase[trackingNumber] = packageData;
            saveDatabase();
            
            const infoDiv = document.getElementById('newPackageInfo');
            const shareableLink = generateShareableLink(trackingNumber);
            
            infoDiv.innerHTML = `
                <div class="animate__animated animate__fadeIn">
                    <h3><i class="fas fa-check-circle" style="color: #2ecc71;"></i> Package Created Successfully!</h3>
                    <p><i class="fas fa-barcode"></i> <strong>Tracking Number:</strong> ${trackingNumber}</p>
                    <p><i class="fas fa-shipping-fast"></i> <strong>Service Type:</strong> ${packageData.service.toUpperCase()}</p>
                    <p><i class="fas fa-ruler-combined"></i> <strong>Dimensions:</strong> ${length}×${width}×${height}cm</p>
                    <p><i class="fas fa-weight-hanging"></i> <strong>Weight:</strong> ${physicalWeight}kg <span class="weight-category ${category.class}"><i class="fas ${category.icon}"></i> ${category.name}</span></p>
                    <p><i class="fas fa-dollar-sign"></i> <strong>Shipping Cost:</strong> $${shippingCost}</p>
                    <p><i class="fas fa-route"></i> <strong>Route:</strong> ${packageData.origin} → ${packageData.destination}</p>
                    
                    <div class="share-options">
                        <h4><i class="fas fa-share-alt"></i> Share Tracking Details:</h4>
                        <button onclick="shareOnWhatsApp('${trackingNumber}')" class="share-btn whatsapp animate__animated animate__pulse">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </button>
                        <button onclick="shareViaEmail('${trackingNumber}')" class="share-btn email animate__animated animate__pulse animate__delay-1s">
                            <i class="fas fa-envelope"></i> Email
                        </button>
                        <button onclick="copyToClipboard('${shareableLink}')" class="share-btn link animate__animated animate__pulse animate__delay-2s">
                            <i class="fas fa-link"></i> Copy Link
                        </button>
                        <button onclick="copyToClipboard('${trackingNumber}')" class="share-btn copy-btn animate__animated animate__pulse animate__delay-3s">
                            <i class="fas fa-copy"></i> Copy Number
                        </button>
                        <div id="qrcode"></div>
                    </div>
                </div>
            `;
            infoDiv.classList.remove('hidden');
            
            QRCode.toCanvas(document.getElementById('qrcode'), shareableLink, { width: 150 }, function (error) {
                if (error) console.error(error);
            });
            
            // Clear form
            document.getElementById('sender').value = '';
            document.getElementById('recipient').value = '';
            document.getElementById('origin').value = '';
            document.getElementById('destination').value = '';
            document.getElementById('service').selectedIndex = 0;
            document.getElementById('length').value = '';
            document.getElementById('width').value = '';
            document.getElementById('height').value = '';
            document.getElementById('weight').value = '';
        }

        function updatePackageStatus() {
            const trackingNumber = document.getElementById('adminTrackingNumber').value;
            const newStatus = document.getElementById('statusUpdate').value;
            const location = document.getElementById('updateLocation').value;
            
            if (!trackingNumber || !newStatus || !location) {
                document.getElementById('updateResult').innerHTML = `
                    <div class="error animate__animated animate__headShake">
                        <i class="fas fa-exclamation-circle"></i> Please fill in all required fields
                    </div>
                `;
                document.getElementById('updateResult').classList.remove('hidden');
                return;
            }
            
            if (!packageDatabase[trackingNumber]) {
                document.getElementById('updateResult').innerHTML = `
                    <div class="error animate__animated animate__headShake">
                        <i class="fas fa-exclamation-triangle"></i> Error: Package not found
                    </div>
                `;
                document.getElementById('updateResult').classList.remove('hidden');
                return;
            }
            
            const packageData = packageDatabase[trackingNumber];
            
            packageData.status = newStatus;
            packageData.currentLocation = location;
            packageData.history.push({
                status: newStatus,
                timestamp: new Date(),
                location: location,
                notes: `Status updated to ${newStatus} at ${location}`
            });
            
            // Heavy package alert
            if (packageData.finalWeight > 20 && newStatus === 'processing') {
                packageData.history.push({
                    status: 'exception',
                    timestamp: new Date(),
                    location: location,
                    notes: 'Heavy package - Special handling required'
                });
            }
            
            saveDatabase();
            
            document.getElementById('updateResult').innerHTML = `
                <div class="animate__animated animate__fadeIn">
                    <h3><i class="fas fa-check-circle" style="color: #2ecc71;"></i> Status Updated Successfully</h3>
                    <p><i class="fas fa-barcode"></i> <strong>Tracking Number:</strong> ${trackingNumber}</p>
                    <p><i class="fas fa-exchange-alt"></i> <strong>New Status:</strong> ${formatStatus(newStatus)}</p>
                    <p><i class="fas fa-map-marker-alt"></i> <strong>Location:</strong> ${location}</p>
                    <p><i class="fas fa-clock"></i> <strong>Updated At:</strong> ${new Date().toLocaleString()}</p>
                </div>
            `;
            document.getElementById('updateResult').classList.remove('hidden');
            
            // Clear form
            document.getElementById('adminTrackingNumber').value = '';
            document.getElementById('updateLocation').value = '';
            document.getElementById('statusUpdate').selectedIndex = 0;
        }
        
        function trackPackage() {
            const trackingNumber = document.getElementById('trackingNumber').value;
            currentTrackingNumber = trackingNumber;
            
            if (!trackingNumber) {
                document.getElementById('packageDetails').innerHTML = `
                    <div class="error animate__animated animate__headShake">
                        <i class="fas fa-exclamation-circle"></i> Please enter a tracking number
                    </div>
                `;
                document.getElementById('trackingResults').classList.remove('hidden');
                return;
            }
            
            const packageData = packageDatabase[trackingNumber];
            const resultsDiv = document.getElementById('trackingResults');
            
            if (!packageData) {
                document.getElementById('packageDetails').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i> No package found with tracking number: ${trackingNumber}
                    </div>
                    <p>Please check the number and try again.</p>
                `;
                resultsDiv.classList.remove('hidden');
                return;
            }
            
            const category = getWeightCategory(packageData.finalWeight);
            const carrierInfo = SHIPPING_RATES[packageData.carrier];
            
            document.getElementById('packageDetails').innerHTML = `
                <div class="animate__animated animate__fadeIn">
                    <h3><i class="fas fa-box-open"></i> Package Details</h3>
                    
                    <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 250px;">
                            <p><i class="fas fa-barcode"></i> <strong>Tracking Number:</strong> ${packageData.trackingNumber}</p>
                            <p><i class="fas fa-exchange-alt"></i> <strong>Status:</strong> ${formatStatus(packageData.status)}</p>
                            <p><i class="fas ${carrierInfo.icon}"></i> <strong>Carrier:</strong> ${packageData.carrier.toUpperCase()}</p>
                            <p><i class="fas fa-shipping-fast"></i> <strong>Service:</strong> ${packageData.service.toUpperCase()}</p>
                        </div>
                        
                        <div style="flex: 1; min-width: 250px;">
                            <p><i class="fas fa-ruler-combined"></i> <strong>Dimensions:</strong> ${packageData.dimensions.length}×${packageData.dimensions.width}×${packageData.dimensions.height}cm</p>
                            <p><i class="fas fa-weight-hanging"></i> <strong>Physical Weight:</strong> ${packageData.physicalWeight}kg</p>
                            <p><i class="fas fa-cube"></i> <strong>Volumetric Weight:</strong> ${packageData.volumetricWeight.toFixed(2)}kg</p>
                            <p><i class="fas fa-balance-scale"></i> <strong>Chargeable Weight:</strong> ${packageData.finalWeight.toFixed(2)}kg 
                                <span class="weight-category ${category.class}"><i class="fas ${category.icon}"></i> ${category.name}</span>
                            </p>
                        </div>
                        
                        <div style="flex: 1; min-width: 250px;">
                            <p><i class="fas fa-dollar-sign"></i> <strong>Shipping Cost:</strong> $${packageData.shippingCost}</p>
                            <p><i class="fas fa-map-marker-alt"></i> <strong>Current Location:</strong> ${packageData.currentLocation}</p>
                            <p><i class="fas fa-route"></i> <strong>Route:</strong> ${packageData.origin} → ${packageData.destination}</p>
                            <p><i class="fas fa-user"></i> <strong>Parties:</strong> ${packageData.sender} → ${packageData.recipient}</p>
                        </div>
                    </div>
                </div>
            `;
            
            const historyDiv = document.getElementById('trackingHistory');
            historyDiv.innerHTML = '';
            
            packageData.history.forEach((event, index) => {
                const isCurrent = index === packageData.history.length - 1;
                const statusInfo = formatStatus(event.status).match(/class="(.*?)".*?>(.*?)<\/span>/);
                const eventDiv = document.createElement('div');
                eventDiv.className = `status-item ${isCurrent ? 'current' : ''} animate__animated animate__fadeInRight`;
                eventDiv.style.animationDelay = `${index * 0.1}s`;
                eventDiv.innerHTML = `
                    <div style="display: flex; gap: 1rem;">
                        <div style="flex-shrink: 0; width: 40px; height: 40px; background: #f8f9fa; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas ${statusInfo[1].includes('fa-') ? statusInfo[1].match(/fa-[a-z-]+/)[0] : 'fa-circle'}"></i>
                        </div>
                        <div>
                            <strong>${statusInfo[2]}</strong>
                            <p style="margin: 0.25rem 0; color: #7f8c8d;"><small>${new Date(event.timestamp).toLocaleString()}</small></p>
                            <p style="margin: 0.25rem 0;"><i class="fas fa-map-marker-alt"></i> ${event.location}</p>
                            ${event.notes ? `<p style="margin: 0.25rem 0; font-style: italic;">${event.notes}</p>` : ''}
                        </div>
                    </div>
                `;
                historyDiv.appendChild(eventDiv);
            });
            
            const shareableLink = generateShareableLink(trackingNumber);
            document.getElementById('whatsappShareBtn').onclick = () => shareOnWhatsApp(trackingNumber);
            document.getElementById('emailShareBtn').onclick = () => shareViaEmail(trackingNumber);
            document.getElementById('copyLinkBtn').onclick = () => copyToClipboard(shareableLink);
            document.getElementById('copyNumberBtn').onclick = () => copyToClipboard(trackingNumber);
            
            const qrCodeDiv = document.querySelector('#trackingResults #qrcode');
            if (qrCodeDiv) {
                qrCodeDiv.innerHTML = '';
                QRCode.toCanvas(qrCodeDiv, shareableLink, { width: 150 }, function (error) {
                    if (error) console.error(error);
                });
            }
            
            resultsDiv.classList.remove('hidden');
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function shareOnWhatsApp(trackingNumber) {
            const packageData = packageDatabase[trackingNumber];
            const link = generateShareableLink(trackingNumber);
            const message = `📦 *SwiftTrack Package Details*

*Tracking Number:* ${trackingNumber}
*Status:* ${formatStatus(packageData.status).replace(/<[^>]+>/g, '')}
*Weight:* ${packageData.finalWeight.toFixed(2)}kg (${packageData.weightCategory})
*Shipping Cost:* $${packageData.shippingCost}
*Current Location:* ${packageData.currentLocation}

Track your package here:
${link}

Thank you for choosing SwiftTrack Express!`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }

        function shareViaEmail(trackingNumber) {
            const packageData = packageDatabase[trackingNumber];
            const link = generateShareableLink(trackingNumber);
            const subject = "Your SwiftTrack Package Tracking Details";
            const body = `
                <div style="font-family: 'Poppins', Arial, sans-serif; max-width: 600px; margin: 0 auto; color: #2c3e50;">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <h1 style="color: #3498db; margin-bottom: 0.5rem;">SwiftTrack Express</h1>
                        <p style="color: #7f8c8d;">Your package tracking details</p>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h2 style="margin-bottom: 1rem; color: #3498db;">Package Information</h2>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <p><strong>Tracking Number:</strong></p>
                                <p>${trackingNumber}</p>
                            </div>
                            <div>
                                <p><strong>Status:</strong></p>
                                <p>${formatStatus(packageData.status).replace(/<[^>]+>/g, '')}</p>
                            </div>
                            <div>
                                <p><strong>Weight:</strong></p>
                                <p>${packageData.finalWeight.toFixed(2)}kg (${packageData.weightCategory})</p>
                            </div>
                            <div>
                                <p><strong>Shipping Cost:</strong></p>
                                <p>$${packageData.shippingCost}</p>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1rem;">
                            <p><strong>Current Location:</strong> ${packageData.currentLocation}</p>
                            <p><strong>Destination:</strong> ${packageData.destination}</p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <a href="${link}" style="display: inline-block; padding: 12px 24px; background: linear-gradient(to right, #3498db, #2ecc71); color: white; text-decoration: none; border-radius: 8px; font-weight: 500; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);">
                                Track Your Package
                            </a>
                        </div>
                    </div>
                    
                    <div style="text-align: center; color: #7f8c8d; font-size: 0.9rem;">
                        <p>Or copy this link: <code style="background: #f8f9fa; padding: 2px 4px; border-radius: 4px;">${link}</code></p>
                        <p style="margin-top: 1rem;">© ${new Date().getFullYear()} SwiftTrack Express. All rights reserved.</p>
                    </div>
                </div>
            `;
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }

        // Initialize
        window.onload = function() {
            // Set up event listeners for real-time calculations
            ['length', 'width', 'height', 'weight'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateWeightCalculations);
            });
            
            document.querySelectorAll('input[name="carrier"]').forEach(radio => {
                radio.addEventListener('change', updateWeightCalculations);
            });
            
            // Check for tracking parameter in URL
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const trackingParam = urlParams.get('tracking');
                
                if (trackingParam) {
                    document.getElementById('trackingNumber').value = trackingParam;
                    setTimeout(() => {
                        trackPackage();
                        document.getElementById('trackingResults').scrollIntoView({
                            behavior: 'smooth'
                        });
                    }, 500);
                }
            } catch (e) {
                console.error("Error initializing page:", e);
            }
            
            // Animate sections sequentially
            const sections = document.querySelectorAll('.section');
            sections.forEach((section, index) => {
                section.style.animationDelay = `${index * 0.2}s`;
            });
        };
    </script>
</body>
</html>